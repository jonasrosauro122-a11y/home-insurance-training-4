<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>LAVA Flappy Quiz Game</title>
<style>
  :root { --accent:#ff1f1f; --bg-dark:#000; --bg-light:#400000; }
  * { box-sizing:border-box; }
  html,body { margin:0; height:100%; background:linear-gradient(135deg,var(--bg-dark),var(--bg-light)); color:#fff; font-family:'Poppins',sans-serif; overflow:hidden; }

  header { position:fixed; top:0; left:0; right:0; background:rgba(0,0,0,0.65); backdrop-filter:blur(5px); display:flex; align-items:center; justify-content:space-between; padding:12px 24px; z-index:10; }
  header a { color:#fff; text-decoration:none; font-weight:700; }
  header img { height:36px; vertical-align:middle; margin-right:8px; }
  nav ul { display:flex; list-style:none; gap:14px; margin:0; padding:0; }
  nav a { color:#fff; text-decoration:none; padding:6px 10px; border-radius:6px; }
  nav a.active, nav a:hover { background:var(--accent); }

  #gameContainer { position:absolute; top:64px; left:0; right:0; bottom:0; display:flex; align-items:center; justify-content:center; }
  canvas { border:3px solid var(--accent); border-radius:12px; box-shadow:0 8px 30px rgba(0,0,0,0.6); }

  #hud { position:absolute; top:80px; width:100%; text-align:center; pointer-events:none; }
  #score { font-size:32px; font-weight:700; }
  #high { font-size:14px; color:#ccc; }

  #questionBox { display:none; position:absolute; top:25%; left:50%; transform:translateX(-50%); background:#111; border:2px solid var(--accent); padding:16px; border-radius:12px; width:90%; max-width:420px; text-align:center; z-index:20; }
  #questionBox input { width:80%; padding:8px; border-radius:6px; border:none; margin-top:8px; }
  #questionBox button { margin-top:8px; padding:8px 14px; border:none; border-radius:8px; background:var(--accent); color:#fff; cursor:pointer; font-weight:700; }

  #overlay { display:none; position:absolute; inset:0; background:rgba(0,0,0,0.8); align-items:center; justify-content:center; flex-direction:column; z-index:30; }
  #overlay button { margin-top:12px; padding:10px 16px; border:none; border-radius:8px; background:var(--accent); color:#fff; font-weight:700; cursor:pointer; }

  #startBox { position:absolute; top:40%; left:50%; transform:translateX(-50%); text-align:center; }
  #startBox input { padding:8px; border-radius:8px; border:none; margin-bottom:8px; width:200px; }
  #startBox button { padding:10px 16px; border:none; border-radius:8px; background:var(--accent); color:#fff; cursor:pointer; font-weight:700; }
</style>
</head>
<body>

<header>
  <a href="index.html"><img src="images/logo.png" alt="Logo">LAVA Classroom</a>
  <nav>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="about.html">Trainers</a></li>
      <li><a href="courses.html">Courses</a></li>
      <li><a href="assignments.html">LAVA University</a></li>
      <li><a href="game.html" class="active">Games</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul>
  </nav>
</header>

<div id="gameContainer">
  <canvas id="gameCanvas" width="420" height="630"></canvas>
  <div id="hud">
    <div id="score">0</div>
    <div id="high">High: 0</div>
  </div>

  <div id="startBox">
    <input id="playerName" type="text" placeholder="Enter your name"><br>
    <button id="startBtn">Start Game</button>
  </div>

  <div id="questionBox">
    <h3 id="questionText"></h3>
    <input id="answerInput" type="text" placeholder="Type your answer">
    <button id="submitBtn">Submit</button>
  </div>

  <div id="overlay">
    <h2>Game Over</h2>
    <p id="finalScore">Score: 0</p>
    <button id="restartBtn">Play Again</button>
  </div>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const birdImg = new Image(); birdImg.src = "images/bird.png";
const pipeImg = new Image(); pipeImg.src = "images/pipe.png";
const bgImg = new Image();   bgImg.src = "images/bg.png";

const startBox = document.getElementById("startBox");
const questionBox = document.getElementById("questionBox");
const questionText = document.getElementById("questionText");
const answerInput = document.getElementById("answerInput");
const submitBtn = document.getElementById("submitBtn");
const overlay = document.getElementById("overlay");
const restartBtn = document.getElementById("restartBtn");
const scoreEl = document.getElementById("score");
const highEl = document.getElementById("high");

let playerName = "";
let bird, pipes, score, highScore = localStorage.getItem("lava_highscore") || 0;
let gravity = 0.6, jump = -9, gap = 150, pipeSpeed = 2.5, gameRunning = false, questionActive = false;
const H = canvas.height, W = canvas.width;

const questions = [
  {q:"An organization of insurers through which risks are pooled.", a:"insurance pool"},
  {q:"Anyone can be an agent. True or False.", a:"false"},
  {q:"A financial agreement to transfer risk for premiums.", a:"insurance"},
  {q:"Professional who evaluates risk.", a:"underwriter"},
  {q:"Amount you pay out of pocket before insurance starts.", a:"deductible"},
  {q:"Person or business protected under a policy.", a:"insured"},
  {q:"Company that provides insurance coverage.", a:"insurer"},
  {q:"Change or addition made to existing policy.", a:"endorsement"},
  {q:"Document outlining terms, coverages, exclusions.", a:"policy"},
  {q:"Meaning of AMS.", a:"agency management system"}
];

function resetGame(){
  bird = {x:80, y:H/2, w:34, h:24, vel:0};
  pipes = [];
  score = 0;
  scoreEl.textContent = 0;
  questionActive = false;
  gameRunning = true;
  overlay.style.display = "none";
  questionBox.style.display = "none";
  startBox.style.display = "none";
}

function spawnPipe(){
  const top = Math.random()*(H-gap-100)+40;
  pipes.push({x:W, top:top, bottom:top+gap});
}

function update(){
  if(!gameRunning || questionActive) return;
  bird.vel += gravity;
  bird.y += bird.vel;

  if(++frame % 90===0) spawnPipe();
  pipes.forEach(p=> p.x -= pipeSpeed);
  pipes = pipes.filter(p=>p.x>-60);

  pipes.forEach(p=>{
    if(p.x + 52 < bird.x && !p.passed){
      score++;
      scoreEl.textContent = score;
      p.passed = true;
      if(score > highScore){ highScore = score; localStorage.setItem("lava_highscore",highScore); highEl.textContent = "High: "+highScore; }
    }
  });

  for(let p of pipes){
    if(bird.x + bird.w > p.x && bird.x < p.x+52 && (bird.y < p.top || bird.y+bird.h > p.bottom)){
      askQuestion();
      return;
    }
  }

  if(bird.y + bird.h > H || bird.y < 0) askQuestion();
}

function draw(){
  if(bgImg.complete) ctx.drawImage(bgImg,0,0,W,H);
  else { ctx.fillStyle="#70c8ff"; ctx.fillRect(0,0,W,H); }
  pipes.forEach(p=>{
    ctx.drawImage(pipeImg,p.x,p.bottom,52,H-p.bottom);
    ctx.save(); ctx.translate(p.x+26,p.top); ctx.scale(1,-1); ctx.drawImage(pipeImg,-26,0,52,H-p.bottom); ctx.restore();
  });
  if(birdImg.complete) ctx.drawImage(birdImg,bird.x,bird.y,bird.w,bird.h);
  else { ctx.fillStyle="red"; ctx.fillRect(bird.x,bird.y,bird.w,bird.h); }
}

function loop(){
  if(gameRunning){ update(); ctx.clearRect(0,0,W,H); draw(); requestAnimationFrame(loop); }
}

function askQuestion(){
  questionActive = true;
  gameRunning = false;
  const q = questions[Math.floor(Math.random()*questions.length)];
  currentQ = q;
  questionText.textContent = q.q;
  answerInput.value = "";
  questionBox.style.display="block";
  answerInput.focus();
}

submitBtn.onclick = ()=>{
  if(answerInput.value.trim().toLowerCase() === currentQ.a.toLowerCase()){
    questionBox.style.display="none";
    questionActive = false;
    gameRunning = true;
    bird.vel = jump;
    loop();
  } else endGame();
};

function endGame(){
  gameRunning = false;
  questionBox.style.display="none";
  overlay.style.display="flex";
  document.getElementById("finalScore").textContent = "Score: " + score;
}

restartBtn.onclick = ()=>{ resetGame(); loop(); };

document.addEventListener("keydown",e=>{ if(e.code==="Space"){ bird.vel=jump; if(!gameRunning){ resetGame(); loop(); } }});
canvas.addEventListener("click",()=>{ bird.vel=jump; if(!gameRunning){ resetGame(); loop(); }});

document.getElementById("startBtn").onclick=()=>{
  playerName=document.getElementById("playerName").value.trim();
  if(!playerName){alert("Please enter your name!");return;}
  resetGame(); loop();
};

let frame=0;
highEl.textContent="High: "+highScore;
</script>
</body>
</html>
