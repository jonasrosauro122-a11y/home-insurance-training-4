<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flappy Bird Insurance Quiz Game</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #000;
      color: #fff;
      font-family: 'Poppins', sans-serif;
    }

    header, footer {
      display: none;
    }

    .game-container {
      display: flex;
      height: 100vh;
      width: 100vw;
      overflow: hidden;
    }

    canvas {
      flex: 1;
      background: url('images/bg.png') center/cover no-repeat;
      display: block;
    }

    .leaderboard, .quizboard {
      width: 250px;
      background: rgba(0, 0, 0, 0.8);
      padding: 15px;
      overflow-y: auto;
      border: 2px solid crimson;
    }

    .leaderboard h2, .quizboard h2 {
      text-align: center;
      color: gold;
      margin-bottom: 10px;
    }

    .score-item {
      display: flex;
      justify-content: space-between;
      padding: 4px 0;
      border-bottom: 1px solid #333;
    }

    .fireworks {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      display: none;
      z-index: 10;
    }

    .message {
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 48px;
      color: gold;
      text-shadow: 0 0 10px red;
      display: none;
      z-index: 11;
    }

    #quiz {
      position: absolute;
      bottom: 30px;
      right: 300px;
      background: rgba(0,0,0,0.8);
      padding: 15px;
      border: 2px solid crimson;
      display: none;
      z-index: 5;
    }

    #giveUpBtn {
      position: absolute;
      top: 10px;
      right: 20px;
      background: crimson;
      color: white;
      padding: 8px 14px;
      border: none;
      cursor: pointer;
      border-radius: 6px;
      z-index: 12;
    }
  </style>
</head>
<body>
  <div class="game-container">
    <div class="leaderboard">
      <h2>Pipe Leaderboard</h2>
      <div id="pipeScores"></div>
    </div>

    <canvas id="gameCanvas" width="480" height="640"></canvas>

    <div class="quizboard">
      <h2>Quiz Leaderboard</h2>
      <div id="quizScores"></div>
    </div>
  </div>

  <div id="quiz">
    <p id="question"></p>
    <div id="answers"></div>
  </div>

  <button id="giveUpBtn">Give Up</button>

  <div class="fireworks" id="fireworks"></div>
  <div class="message" id="message"></div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    let bird = new Image();
    bird.src = 'images/bird.png';
    let bg = new Image();
    bg.src = 'images/bg.png';
    let pipe = new Image();
    pipe.src = 'images/pipe.png';

    let gap = 130;
    let constant;
    let bX = 50;
    let bY = 150;
    let gravity = 1.5;
    let score = 0;
    let failCount = 0;
    let playerName = localStorage.getItem('playerName') || prompt("Enter your name:");
    localStorage.setItem('playerName', playerName);

    let pipeArray = [];
    pipeArray[0] = { x: canvas.width, y: 0 };

    document.addEventListener("keydown", moveUp);
    function moveUp() { bY -= 25; }

    function draw() {
      ctx.drawImage(bg, 0, 0);

      for (let i = 0; i < pipeArray.length; i++) {
        constant = pipe.height + gap;
        ctx.drawImage(pipe, pipeArray[i].x, pipeArray[i].y);
        ctx.drawImage(pipe, pipeArray[i].x, pipeArray[i].y + constant);

        pipeArray[i].x--;

        if (pipeArray[i].x == 125) {
          pipeArray.push({ x: canvas.width, y: Math.floor(Math.random() * pipe.height) - pipe.height });
        }

        if (bX + bird.width >= pipeArray[i].x && bX <= pipeArray[i].x + pipe.width &&
            (bY <= pipeArray[i].y + pipe.height || bY + bird.height >= pipeArray[i].y + constant) ||
            bY + bird.height >= canvas.height) {
          failCount++;
          if (failCount >= 5) endGame();
          resetGame();
        }

        if (pipeArray[i].x == 5) {
          score++;
          updateLeaderboards();
          if (score == 10) showFireworks("Awesome!");
          if (score == 15) showFireworks("You are Insurance VA Expert!");
          if (score % 5 == 0) showQuiz();
        }
      }

      ctx.drawImage(bird, bX, bY);
      bY += gravity;
      requestAnimationFrame(draw);
    }
    draw();

    function resetGame() {
      bX = 50;
      bY = 150;
      pipeArray = [{ x: canvas.width, y: 0 }];
      score = 0;
    }

    function showFireworks(text) {
      const fireworks = document.getElementById('fireworks');
      const message = document.getElementById('message');
      fireworks.style.display = 'block';
      message.style.display = 'block';
      message.textContent = text;
      setTimeout(() => {
        fireworks.style.display = 'none';
        message.style.display = 'none';
      }, 3000);
    }

    const quizData = [
      { q: "What does liability insurance primarily cover?", a: ["Legal responsibility", "Car damages", "Medical bills"], c: 0 },
      { q: "Coverage A in Homeowners covers what?", a: ["Dwelling", "Other Structures", "Personal Property"], c: 0 },
      { q: "Which insurance helps in cyber attacks?", a: ["Cyber Liability", "General Liability", "Auto"], c: 0 },
      { q: "ACORD forms are used for?", a: ["Insurance documentation", "Customer emails", "Payment receipts"], c: 0 },
      { q: "What is a deductible?", a: ["Amount you pay before insurance", "Premium", "Total policy limit"], c: 0 },
      { q: "What is a BOP in commercial insurance?", a: ["Business Owner’s Policy", "Basic Office Plan", "Broker Option Policy"], c: 0 },
      { q: "What coverage pays for someone injured at your home?", a: ["Medical Payments", "Dwelling", "Loss of Use"], c: 0 },
      { q: "Which auto coverage pays for your car repairs?", a: ["Collision", "Liability", "Comprehensive"], c: 0 },
      { q: "What does ‘premium’ mean?", a: ["Amount paid for insurance", "Discount", "Claim check"], c: 0 },
      { q: "Which coverage helps replace belongings?", a: ["Personal Property", "Dwelling", "Liability"], c: 0 },
      { q: "What is Coverage B in Home Insurance?", a: ["Other Structures", "Dwelling", "Loss of Use"], c: 0 },
      { q: "Umbrella insurance provides?", a: ["Extra liability protection", "Car coverage", "Health coverage"], c: 0 },
      { q: "Flood damage is covered by?", a: ["Flood Policy", "Homeowners", "Auto"], c: 0 },
      { q: "What is E&O insurance for?", a: ["Professional mistakes", "Home damage", "Medical bills"], c: 0 },
      { q: "Workers’ Compensation covers?", a: ["Employee injury at work", "Client injury", "Property loss"], c: 0 },
      { q: "Cyber Liability helps with?", a: ["Data breaches", "Car theft", "House fires"], c: 0 },
      { q: "Commercial Property Insurance covers?", a: ["Business buildings & equipment", "Employee injury", "Car accident"], c: 0 },
      { q: "Auto Liability covers?", a: ["Other people’s injuries/damages", "Your car only", "Flood loss"], c: 0 },
      { q: "Loss of Use coverage helps when?", a: ["You can’t live in your home", "Car is stolen", "Policy expires"], c: 0 },
      { q: "Why do agencies use ACORD 25?", a: ["Certificate of Insurance", "Billing form", "Claim form"], c: 0 }
    ];

    let quizScore = 0;
    const quizBox = document.getElementById("quiz");
    const qText = document.getElementById("question");
    const answersDiv = document.getElementById("answers");

    function showQuiz() {
      let q = quizData[Math.floor(Math.random() * quizData.length)];
      quizBox.style.display = "block";
      qText.textContent = q.q;
      answersDiv.innerHTML = '';
      q.a.forEach((ans, i) => {
        const btn = document.createElement('button');
        btn.textContent = ans;
        btn.onclick = () => {
          if (i === q.c) quizScore++;
          else failCount++;
          updateLeaderboards();
          quizBox.style.display = "none";
          if (failCount >= 5) endGame();
        };
        answersDiv.appendChild(btn);
      });
    }

    function updateLeaderboards() {
      let data = JSON.parse(localStorage.getItem('lavaLeaderboard') || '{}');
      data[playerName] = { pipes: score, quiz: quizScore };
      localStorage.setItem('lavaLeaderboard', JSON.stringify(data));
      renderLeaderboards();
    }

    function renderLeaderboards() {
      const data = JSON.parse(localStorage.getItem('lavaLeaderboard') || '{}');
      const pipeDiv = document.getElementById('pipeScores');
      const quizDiv = document.getElementById('quizScores');
      pipeDiv.innerHTML = '';
      quizDiv.innerHTML = '';

      Object.entries(data).forEach(([name, scores]) => {
        let p = document.createElement('div');
        p.className = 'score-item';
        p.innerHTML = `<span>${name}</span><span>${scores.pipes}</span>`;
        pipeDiv.appendChild(p);

        let q = document.createElement('div');
        q.className = 'score-item';
        q.innerHTML = `<span>${name}</span><span>${scores.quiz}</span>`;
        quizDiv.appendChild(q);
      });
    }

    renderLeaderboards();

    function endGame() {
      alert(`Game Over, ${playerName}! Returning to Dashboard.`);
      window.location.href = "game.html";
    }

    document.getElementById("giveUpBtn").onclick = endGame;
  </script>
</body>
</html>
