<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>LAVA Classroom | Flappy Bird Quiz Game</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: linear-gradient(to bottom right, #000000, #8B0000);
    font-family: Arial, sans-serif;
    color: #fff;
  }

  header.site-header {
    position: absolute;
    width: 100%;
    z-index: 10;
    background: rgba(0, 0, 0, 0.5);
  }

  canvas {
    display: block;
    margin: 0 auto;
    background: url('images/bg.png') center/cover no-repeat;
  }

  #giveUpBtn {
    position: absolute;
    top: 70px;
    right: 30px;
    background: #ff4c4c;
    color: #fff;
    border: none;
    font-size: 16px;
    font-weight: bold;
    padding: 10px 15px;
    border-radius: 10px;
    cursor: pointer;
    z-index: 10;
    transition: background 0.3s;
  }

  #giveUpBtn:hover {
    background: #ff1c1c;
  }

  #questionBox {
    display: none;
    position: absolute;
    top: 25%;
    left: 50%;
    transform: translateX(-50%);
    background: #111;
    border: 2px solid #ff4c4c;
    padding: 20px;
    border-radius: 12px;
    width: 90%;
    max-width: 400px;
    text-align: center;
    z-index: 20;
  }

  #questionBox input {
    width: 80%;
    padding: 8px;
    border-radius: 6px;
    border: none;
    margin-top: 8px;
  }

  #questionBox button {
    margin-top: 10px;
    padding: 8px 16px;
    border: none;
    border-radius: 8px;
    background: #ff4c4c;
    color: #fff;
    font-weight: bold;
    cursor: pointer;
  }

  /* Leaderboard Modal */
  .modal {
    display: none;
    position: fixed;
    z-index: 50;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
  }

  .modal-content {
    background: #111;
    color: #fff;
    margin: 10% auto;
    padding: 20px;
    width: 90%;
    max-width: 500px;
    border-radius: 15px;
    text-align: center;
  }

  .modal h2 {
    color: #ff4c4c;
  }

  .leaderboard-list {
    list-style: none;
    padding: 0;
    margin-top: 15px;
  }

  .leaderboard-list li {
    background: #222;
    margin: 8px 0;
    padding: 10px;
    border-radius: 8px;
    font-weight: bold;
  }

  .closeBtn {
    background: #ff4c4c;
    border: none;
    color: #fff;
    font-size: 16px;
    padding: 8px 15px;
    margin-top: 15px;
    border-radius: 10px;
    cursor: pointer;
  }

  .closeBtn:hover {
    background: #ff1c1c;
  }
</style>
</head>
<body>

<header class="site-header">
  <div class="header-inner container">
    <a href="index.html" class="brand">
      <img src="images/logo.png" alt="LAVA Logo" style="height:40px;vertical-align:middle;">
      <span style="color:#fff;">LAVA Classroom</span>
    </a>
    <nav class="main-nav">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="courses.html">Courses</a></li>
        <li><a href="assignments.html">Assignments</a></li>
        <li><a href="game.html" class="active">Games</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
    </nav>
  </div>
</header>

<canvas id="gameCanvas" width="480" height="640"></canvas>
<button id="giveUpBtn">Give Up</button>

<!-- Question Popup -->
<div id="questionBox">
  <h3 id="questionText"></h3>
  <input id="answerInput" type="text" placeholder="Type your answer">
  <button id="submitBtn">Submit</button>
</div>

<!-- Leaderboard Modal -->
<div id="leaderboardModal" class="modal">
  <div class="modal-content">
    <h2>üèÜ LAVA Leaderboard</h2>
    <ul id="leaderboardList" class="leaderboard-list"></ul>
    <button class="closeBtn" onclick="closeLeaderboard()">Close</button>
  </div>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let birdImg = new Image(), pipeImg = new Image(), bgImg = new Image();
birdImg.src = "images/bird.png";
pipeImg.src = "images/pipe.png";
bgImg.src = "images/bg.png";

let birdX = 50, birdY = 150, birdVelocity = 0;
let gravity = 0.25, gap = 120, pipeWidth = 52;
let pipes = [], score = 0, fails = 0, gameOver = false, questionActive = false;

const questions = [
  {q:"An organization of insurers through which risks are pooled.", a:"insurance pool"},
  {q:"Anyone can be an agent. True or False.", a:"false"},
  {q:"A financial agreement to transfer risk for premiums.", a:"insurance"},
  {q:"Professional who evaluates risk.", a:"underwriter"},
  {q:"Amount you pay out of pocket before insurance starts.", a:"deductible"},
  {q:"Person or business protected under a policy.", a:"insured"},
  {q:"Company that provides insurance coverage.", a:"insurer"},
  {q:"Change or addition made to existing policy.", a:"endorsement"},
  {q:"Document outlining terms, coverages, exclusions.", a:"policy"},
  {q:"Meaning of AMS.", a:"agency management system"}
];

let currentQ = null;

document.addEventListener("keydown", flap);
document.addEventListener("click", flap);

function flap() {
  if (!gameOver && !questionActive) birdVelocity = -4.5;
}

function resetGame() {
  birdY = 150; birdVelocity = 0; pipes = [];
  score = 0; gameOver = false; fails = 0;
  loop();
}

function draw() {
  ctx.drawImage(bgImg, 0, 0, canvas.width, canvas.height);
  ctx.drawImage(birdImg, birdX, birdY, 34, 24);

  for (let i = 0; i < pipes.length; i++) {
    let p = pipes[i];
    ctx.drawImage(pipeImg, p.x, p.y);
    ctx.drawImage(pipeImg, p.x, p.y + pipeImg.height + gap);
    p.x -= 2;

    if (p.x + pipeWidth < 0) {
      pipes.splice(i, 1); i--; score++;
    }

    if (
      birdX + 34 > p.x &&
      birdX < p.x + pipeWidth &&
      (birdY < p.y + pipeImg.height || birdY + 24 > p.y + pipeImg.height + gap)
    ) {
      askQuestion();
      return;
    }
  }

  birdVelocity += gravity;
  birdY += birdVelocity;

  if (birdY + 24 >= canvas.height || birdY < 0) {
    askQuestion();
  }

  ctx.fillStyle = "#fff";
  ctx.font = "20px Arial";
  ctx.fillText("Score: " + score, 10, 25);
}

let pipeSpawnCounter = 0;
function loop() {
  if (gameOver) return;
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  draw();
  pipeSpawnCounter++;
  if (pipeSpawnCounter % 100 === 0) {
    let pipeY = Math.floor(Math.random() * (pipeImg.height - 100)) - pipeImg.height;
    pipes.push({ x: canvas.width, y: pipeY });
  }
  requestAnimationFrame(loop);
}

function askQuestion() {
  questionActive = true;
  const q = questions[Math.floor(Math.random() * questions.length)];
  currentQ = q;
  document.getElementById("questionText").textContent = q.q;
  document.getElementById("answerInput").value = "";
  document.getElementById("questionBox").style.display = "block";
}

document.getElementById("submitBtn").onclick = function() {
  const answer = document.getElementById("answerInput").value.trim().toLowerCase();
  if (answer === currentQ.a.toLowerCase()) {
    questionActive = false;
    document.getElementById("questionBox").style.display = "none";
    loop();
  } else {
    fails++;
    questionActive = false;
    document.getElementById("questionBox").style.display = "none";
    if (fails >= 5) showLeaderboard();
    else loop();
  }
};

function endGame() {
  fails++;
  if (fails >= 5) showLeaderboard();
  else resetGame();
}

// Leaderboard
const leaderboardModal = document.getElementById("leaderboardModal");
const leaderboardList = document.getElementById("leaderboardList");

function showLeaderboard() {
  gameOver = true;
  let name = prompt("Game Over! Enter your name:");
  if (name) {
    let leaderboard = JSON.parse(localStorage.getItem("leaderboard")) || [];
    leaderboard.push({ name, score });
    leaderboard.sort((a, b) => b.score - a.score);
    leaderboard = leaderboard.slice(0, 5);
    localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
  }
  displayLeaderboard();
  leaderboardModal.style.display = "block";
}

function displayLeaderboard() {
  let leaderboard = JSON.parse(localStorage.getItem("leaderboard")) || [];
  leaderboardList.innerHTML = leaderboard
    .map((p, i) => `<li>${i + 1}. ${p.name} ‚Äî ${p.score} pts</li>`)
    .join("");
}

function closeLeaderboard() {
  leaderboardModal.style.display = "none";
  window.location.href = "game.html";
}

document.getElementById("giveUpBtn").addEventListener("click", showLeaderboard);

loop();
</script>
</body>
</html>
