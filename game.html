<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LAVA Classroom Game</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #000, #7a0000);
      color: #fff;
    }

    header.site-header {
      background: #000;
      color: white;
      padding: 10px 0;
      text-align: center;
      font-weight: bold;
      font-size: 1.3rem;
      border-bottom: 3px solid red;
    }

    canvas {
      background: url('images/bg.png') repeat-x;
      background-size: cover;
      display: block;
      margin: 0 auto;
    }

    #gameContainer {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      height: calc(100vh - 70px);
      overflow: hidden;
    }

    .leaderboard, .quizboard {
      width: 20%;
      background: rgba(0,0,0,0.8);
      padding: 15px;
      box-shadow: 0 0 20px red;
      border-radius: 10px;
      margin: 10px;
      height: 90%;
      overflow-y: auto;
    }

    .leaderboard h2, .quizboard h2 {
      color: #ff2b2b;
      text-align: center;
      border-bottom: 2px solid red;
      padding-bottom: 5px;
    }

    .leaderboard ul, .quizboard ul {
      list-style: none;
      padding: 0;
    }

    .leaderboard li, .quizboard li {
      padding: 5px 10px;
      margin: 5px 0;
      background: #111;
      border-radius: 5px;
    }

    .leaderboard li.top {
      background: #ff2b2b;
      color: #fff;
      font-weight: bold;
    }

    #giveUpBtn {
      position: absolute;
      top: 90px;
      right: 30px;
      background: red;
      border: none;
      color: #fff;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 6px;
      box-shadow: 0 0 10px #ff0000;
    }

    #giveUpBtn:hover {
      background: #a10000;
    }

    #quizContainer {
      position: absolute;
      bottom: 50px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.85);
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      color: white;
      display: none;
      box-shadow: 0 0 20px red;
    }

    #quizContainer button {
      background: red;
      color: #fff;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }

    #quizContainer button:hover {
      background: #b30000;
    }

    #gameOverModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      color: #fff;
      z-index: 1000;
    }

    #gameOverModal button {
      margin-top: 20px;
      background: red;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 18px;
      cursor: pointer;
    }

    .fireworks {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      pointer-events: none;
      display: none;
      animation: explode 1s ease-out infinite;
    }

    @keyframes explode {
      0% {opacity: 1; transform: scale(0);}
      100% {opacity: 0; transform: scale(2);}
    }

  </style>
</head>
<body>

<header class="site-header">
  üéÆ LAVA Classroom Insurance Game
</header>

<div id="gameContainer">
  <div class="leaderboard">
    <h2>üèÜ Pipe Scores</h2>
    <ul id="pipeScores"></ul>
  </div>

  <canvas id="gameCanvas" width="480" height="640"></canvas>

  <div class="quizboard">
    <h2>üß† Quiz Scores</h2>
    <ul id="quizScores"></ul>
  </div>
</div>

<button id="giveUpBtn">Give Up</button>

<div id="quizContainer">
  <h3 id="question"></h3>
  <div id="answers"></div>
</div>

<div id="gameOverModal">
  <h1 id="gameOverText">Game Over</h1>
  <button onclick="returnToDashboard()">Return to Dashboard</button>
</div>

<div class="fireworks" id="fireworks"></div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let bird = new Image();
let bg = new Image();
let pipeImg = new Image();

bird.src = 'images/bird.png';
bg.src = 'images/bg.png';
pipeImg.src = 'images/pipe.png';

let gap = 120;
let constant;
let bX = 10;
let bY = 150;
let gravity = 1.5;
let score = 0;
let quizScore = 0;
let failCount = 0;

let pipe = [];
pipe[0] = {x: canvas.width, y: 0};

document.addEventListener("keydown", moveUp);
function moveUp(){ bY -= 25; }

function draw() {
  ctx.drawImage(bg, 0, 0);

  for (let i = 0; i < pipe.length; i++) {
    constant = pipeImg.height + gap;
    ctx.drawImage(pipeImg, pipe[i].x, pipe[i].y);
    ctx.drawImage(pipeImg, pipe[i].x, pipe[i].y + constant);
    pipe[i].x--;

    if (pipe[i].x == 125) {
      pipe.push({x: canvas.width, y: Math.floor(Math.random() * pipeImg.height) - pipeImg.height});
    }

    if (bX + bird.width >= pipe[i].x && bX <= pipe[i].x + pipeImg.width && 
      (bY <= pipe[i].y + pipeImg.height || bY + bird.height >= pipe[i].y + constant) || 
      bY + bird.height >= canvas.height) {
        failCount++;
        if (failCount >= 5) showGameOver();
        return;
    }

    if (pipe[i].x == 5) {
      score++;
      if (score == 10) showFireworks('Awesome!');
      if (score == 15) showFireworks('You are Insurance VA Expert!');
      updateLeaderboards();
      if (score % 3 == 0) showQuiz();
    }
  }

  ctx.drawImage(bird, bX, bY);
  bY += gravity;

  ctx.fillStyle = "#fff";
  ctx.font = "20px Verdana";
  ctx.fillText("Score: " + score, 10, canvas.height - 20);

  requestAnimationFrame(draw);
}

function showQuiz() {
  document.getElementById('quizContainer').style.display = 'block';
  loadQuestion();
}

function hideQuiz() {
  document.getElementById('quizContainer').style.display = 'none';
}

const questions = [
  {q:"What does liability insurance cover?", a:["Damage you cause to others","Your own injuries","Only theft","Natural disasters"], correct:0},
  {q:"What is deductible?", a:["Amount insurer pays","Amount you pay before insurance","Tax credit","Commission"], correct:1},
  {q:"What does 'premium' mean?", a:["The payment for coverage","The limit of coverage","Discount","Policy expiration"], correct:0},
  {q:"What is ACORD Form used for?", a:["Policy cancellation","Certificate of insurance","Filing taxes","License renewal"], correct:1},
  {q:"What is 'endorsement'?", a:["Policy change","Claim payment","Underwriting report","Billing issue"], correct:0},
  {q:"Home Insurance Coverage A is for?", a:["Dwelling","Personal property","Liability","Loss of use"], correct:0},
  {q:"Coverage B refers to?", a:["Other structures","Dwelling","Medical payments","Water damage"], correct:0},
  {q:"Umbrella insurance provides?", a:["Extra liability limit","Flood coverage","Car repair","Mortgage"], correct:0},
  {q:"Cyber Liability protects against?", a:["Data breaches","Storm damage","Fire","Theft"], correct:0},
  {q:"Flood insurance is provided by?", a:["NFIP","FEMA only","Private agents only","Auto carriers"], correct:0},
  {q:"What is peril?", a:["Cause of loss","Policy type","Payment mode","Agent type"], correct:0},
  {q:"Declarations page shows?", a:["Policy details","Claim status","Invoices","Personal notes"], correct:0},
  {q:"Named peril policy covers?", a:["Listed causes only","All losses","Exclusions","Uninsured"], correct:0},
  {q:"Inland marine covers?", a:["Movable property","Houses","Boats","Buildings"], correct:0},
  {q:"Business Owners Policy (BOP) combines?", a:["Property & Liability","Auto & Health","Workers Comp","Life & Disability"], correct:0},
  {q:"Auto Liability splits 100/300/50 mean?", a:["Per person/accident/property","Rates","Mileage","Deductible"], correct:0},
  {q:"Workers Comp covers?", a:["Employee injuries","Property damage","Auto theft","Fire"], correct:0},
  {q:"Medical payments cover?", a:["Immediate medical costs","Long-term loss","Business loans","Disability"], correct:0},
  {q:"Comprehensive Auto covers?", a:["Non-collision damages","Collisions","Liability","Parking fees"], correct:0},
  {q:"Collision coverage covers?", a:["Your car hitting objects","Natural disasters","Theft","Vandalism"], correct:0}
];

let currentQuestion = 0;

function loadQuestion() {
  let q = questions[currentQuestion % questions.length];
  document.getElementById('question').innerText = q.q;
  let answersDiv = document.getElementById('answers');
  answersDiv.innerHTML = "";
  q.a.forEach((ans, i)=>{
    let btn = document.createElement('button');
    btn.innerText = ans;
    btn.onclick = ()=>checkAnswer(i, q.correct);
    answersDiv.appendChild(btn);
  });
}

function checkAnswer(selected, correct) {
  if (selected === correct) {
    quizScore++;
    alert("‚úÖ Correct!");
  } else {
    alert("‚ùå Wrong!");
  }
  updateLeaderboards();
  currentQuestion++;
  hideQuiz();
}

function updateLeaderboards() {
  localStorage.setItem('pipeScore', score);
  localStorage.setItem('quizScore', quizScore);
  renderLeaderboard();
}

function renderLeaderboard() {
  document.getElementById('pipeScores').innerHTML = `<li class="top">You: ${score}</li>`;
  document.getElementById('quizScores').innerHTML = `<li class="top">You: ${quizScore}</li>`;
}

function showGameOver() {
  document.getElementById('gameOverModal').style.display = 'flex';
}

function returnToDashboard() {
  window.location.href = "game.html";
}

function showFireworks(message) {
  const fw = document.getElementById('fireworks');
  fw.style.display = 'block';
  document.getElementById('gameOverText').innerText = message;
  setTimeout(()=>fw.style.display='none',3000);
}

document.getElementById('giveUpBtn').onclick = showGameOver;

renderLeaderboard();
draw();
</script>
</body>
</html>
