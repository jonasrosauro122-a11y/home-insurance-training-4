<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
Â  <title>LAVA Classroom Game</title>
Â  <style>
Â  Â  body {
Â  Â  Â  margin: 0;
Â  Â  Â  overflow: hidden;
Â  Â  Â  font-family: 'Poppins', sans-serif;
Â  Â  Â  background: linear-gradient(135deg, #000, #7a0000);
Â  Â  Â  color: #fff;
Â  Â  }

Â  Â  header.site-header {
Â  Â  Â  background: #000;
Â  Â  Â  color: white;
Â  Â  Â  padding: 10px 0;
Â  Â  Â  text-align: center;
Â  Â  Â  font-weight: bold;
Â  Â  Â  font-size: 1.3rem;
Â  Â  Â  border-bottom: 3px solid red;
Â  Â  }

Â  Â  #gameContainer {
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: center;
Â  Â  Â  align-items: center;
Â  Â  Â  gap: 15px;
Â  Â  Â  height: 500px;
Â  Â  Â  margin: 40px auto;
Â  Â  Â  overflow: hidden;
Â  Â  Â  max-width: 1200px;
Â  Â  }

Â  Â  canvas {
Â  Â  Â  background: url('images/bg.png') repeat-x;
Â  Â  Â  background-size: cover;
Â  Â  Â  display: block;
Â  Â  Â  margin: 0 auto;
Â  Â  Â  width: 480px;
Â  Â  Â  height: 400px;
Â  Â  Â  border-radius: 10px;
Â  Â  Â  box-shadow: 0 0 15px red;
Â  Â  }

Â  Â  .leaderboard, .quizboard {
Â  Â  Â  width: 220px;
Â  Â  Â  background: rgba(0,0,0,0.85);
Â  Â  Â  padding: 15px;
Â  Â  Â  box-shadow: 0 0 20px red;
Â  Â  Â  border-radius: 10px;
Â  Â  Â  height: 90%;
Â  Â  Â  overflow-y: auto;
Â  Â  }

Â  Â  .leaderboard h2, .quizboard h2 {
Â  Â  Â  color: #ff2b2b;
Â  Â  Â  text-align: center;
Â  Â  Â  border-bottom: 2px solid red;
Â  Â  Â  padding-bottom: 5px;
Â  Â  Â  font-size: 1.1em;
Â  Â  }

Â  Â  .leaderboard ul, .quizboard ul {
Â  Â  Â  list-style: none;
Â  Â  Â  padding: 0;
Â  Â  Â  margin: 0;
Â  Â  }

Â  Â  .leaderboard li, .quizboard li {
Â  Â  Â  padding: 5px 10px;
Â  Â  Â  margin: 5px 0;
Â  Â  Â  background: #111;
Â  Â  Â  border-radius: 5px;
Â  Â  Â  font-size: 0.9em;
Â  Â  }

Â  Â  .leaderboard li.top {
Â  Â  Â  background: #ff2b2b;
Â  Â  Â  color: #fff;
Â  Â  Â  font-weight: bold;
Â  Â  Â  box-shadow: 0 0 10px #ff2b2b;
Â  Â  }

Â  Â  #giveUpBtn {
Â  Â  Â  position: absolute;
Â  Â  Â  top: 90px;
Â  Â  Â  right: 30px;
Â  Â  Â  background: red;
Â  Â  Â  border: none;
Â  Â  Â  color: #fff;
Â  Â  Â  padding: 10px 20px;
Â  Â  Â  font-size: 16px;
Â  Â  Â  cursor: pointer;
Â  Â  Â  border-radius: 6px;
Â  Â  Â  box-shadow: 0 0 10px #ff0000;
Â  Â  }

Â  Â  #giveUpBtn:hover {
Â  Â  Â  background: #a10000;
Â  Â  }

Â  Â  #quizContainer {
Â  Â  Â  position: absolute;
Â  Â  Â  bottom: 30px;
Â  Â  Â  left: 50%;
Â  Â  Â  transform: translateX(-50%);
Â  Â  Â  background: rgba(0,0,0,0.9);
Â  Â  Â  padding: 20px;
Â  Â  Â  border-radius: 10px;
Â  Â  Â  text-align: center;
Â  Â  Â  color: white;
Â  Â  Â  display: none;
Â  Â  Â  box-shadow: 0 0 20px red;
Â  Â  Â  width: 350px;
Â  Â  Â  z-index: 900; /* Added z-index */
Â  Â  }

Â  Â  #quizContainer button {
Â  Â  Â  background: red;
Â  Â  Â  color: #fff;
Â  Â  Â  border: none;
Â  Â  Â  padding: 10px 15px;
Â  Â  Â  border-radius: 5px;
Â  Â  Â  cursor: pointer;
Â  Â  Â  margin: 5px;
Â  Â  }

Â  Â  #quizContainer button:hover {
Â  Â  Â  background: #b30000;
Â  Â  }

Â  Â  #gameOverModal {
Â  Â  Â  position: fixed;
Â  Â  Â  top: 0;
Â  Â  Â  left: 0;
Â  Â  Â  width: 100%;
Â  Â  Â  height: 100%;
Â  Â  Â  background: rgba(0,0,0,0.9);
Â  Â  Â  display: none;
Â  Â  Â  justify-content: center;
Â  Â  Â  align-items: center;
Â  Â  Â  flex-direction: column;
Â  Â  Â  color: #fff;
Â  Â  Â  z-index: 1000;
Â  Â  }

Â  Â  #gameOverModal button {
Â  Â  Â  margin-top: 20px;
Â  Â  Â  background: red;
Â  Â  Â  color: white;
Â  Â  Â  padding: 10px 20px;
Â  Â  Â  border: none;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  font-size: 18px;
Â  Â  Â  cursor: pointer;
Â  Â  Â  box-shadow: 0 0 10px #ff0000;
Â  Â  }

Â  Â  /* New styles for the countdown */
Â  Â  #countdownOverlay {
Â  Â  Â  position: absolute;
Â  Â  Â  top: 0;
Â  Â  Â  left: 0;
Â  Â  Â  width: 100%;
Â  Â  Â  height: 100%;
Â  Â  Â  background: rgba(0,0,0,0.7);
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: center;
Â  Â  Â  align-items: center;
Â  Â  Â  font-size: 8em;
Â  Â  Â  color: #ff2b2b;
Â  Â  Â  font-weight: bold;
Â  Â  Â  z-index: 500;
Â  Â  }


Â  Â  .fireworks {
Â  Â  Â  position: fixed;
Â  Â  Â  width: 100%;
Â  Â  Â  height: 100%;
Â  Â  Â  top: 0;
Â  Â  Â  left: 0;
Â  Â  Â  pointer-events: none;
Â  Â  Â  display: none;
Â  Â  Â  z-index: 2000;
Â  Â  }

Â  Â  .spark {
Â  Â  Â  position: absolute;
Â  Â  Â  width: 5px;
Â  Â  Â  height: 5px;
Â  Â  Â  background: radial-gradient(circle, #ff0000, #ff6600, transparent);
Â  Â  Â  border-radius: 50%;
Â  Â  Â  animation: explode 1s ease-out forwards;
Â  Â  }

Â  Â  @keyframes explode {
Â  Â  Â  from { transform: scale(0) translateY(0); opacity: 1; }
Â  Â  Â  to { transform: scale(2) translateY(-200px); opacity: 0; }
Â  Â  }

Â  Â  @media (max-width: 768px) {
Â  Â  Â  #gameContainer {
Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  height: auto;
Â  Â  Â  }
Â  Â  Â  canvas {
Â  Â  Â  Â  width: 90%;
Â  Â  Â  Â  height: auto;
Â  Â  Â  }
Â  Â  Â  .leaderboard, .quizboard {
Â  Â  Â  Â  width: 90%;
Â  Â  Â  Â  height: auto;
Â  Â  Â  }
Â  Â  }
Â  </style>
</head>

<body>
<header class="site-header">
Â  ğŸ® LAVA Classroom Insurance Game
</header>

<div id="gameContainer">
Â  <div class="leaderboard">
Â  Â  <h2>ğŸ† Pipe Scores</h2>
Â  Â  <ul id="pipeScores"></ul>
Â  </div>

Â  <div style="position: relative;">
Â  Â  <canvas id="gameCanvas" width="480" height="400"></canvas>
Â  Â  <div id="countdownOverlay">3</div>
Â  </div>

Â  <div class="quizboard">
Â  Â  <h2>ğŸ§  Quiz Scores</h2>
Â  Â  <ul id="quizScores"></ul>
Â  </div>
</div>

<button id="giveUpBtn">Give Up</button>

<div id="quizContainer">
Â  <h3 id="question"></h3>
Â  <div id="answers"></div>
</div>

<div id="gameOverModal">
Â  <h1 id="gameOverText">Game Over</h1>
Â  <button onclick="returnToDashboard()">Return to Dashboard</button>
</div>

<div class="fireworks" id="fireworks"></div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const countdownOverlay = document.getElementById('countdownOverlay');

const birdSprite = new Image();
birdSprite.src = 'images/bird.png'; // Use a 3-frame bird sprite sheet (wider)
const bg = new Image();
bg.src = 'images/bg.png';
const pipeImg = new Image();
pipeImg.src = 'images/pipe.png';

let frame = 0;
let flapSpeed = 6;
let spriteWidth = 34; // Width of a single bird frame
let spriteHeight = 24; // Height of a single bird frame
let birdWidth = 38;
let birdHeight = 26;
let gap = 120;
let constant;
let bX = 10;
let bY = 150;
let gravity = 1.5;
let score = 0;
let quizScore = 0;
let failCount = 0;
let pipe = [{ x: canvas.width, y: 0 }];

// --- New Game State Variable ---
let gameState = 'ready'; // Possible states: 'ready', 'playing', 'gameover'
// -------------------------------

// Wait for all images to load before starting the game
Promise.all([
Â  new Promise(resolve => birdSprite.onload = resolve),
Â  new Promise(resolve => bg.onload = resolve),
Â  new Promise(resolve => pipeImg.onload = resolve)
]).then(() => {
Â  // Start the countdown after images load
Â  startCountdown();
});

document.addEventListener("keydown", moveUp);

function moveUp() {
Â  // Only allow moving up when the game is playing
Â  if (gameState === 'playing') {
Â  Â  bY -= 25;
Â  } else if (gameState === 'ready') {
Â  Â  // Optional: Start game immediately on first key press if not using countdown
Â  Â  // startGame(); 
Â  }
}

function draw() {
Â  ctx.drawImage(bg, 0, 0, canvas.width, canvas.height);

Â  if (gameState === 'playing') {
Â  Â  for (let i = 0; i < pipe.length; i++) {
Â  Â  Â  constant = pipeImg.height + gap;
Â  Â  Â  ctx.drawImage(pipeImg, pipe[i].x, pipe[i].y, 60, 200);
Â  Â  Â  ctx.drawImage(pipeImg, pipe[i].x, pipe[i].y + constant, 60, 200);
Â  Â  Â  pipe[i].x--; // Move pipe

Â  Â  Â  if (pipe[i].x === 125) {
Â  Â  Â  Â  pipe.push({x: canvas.width, y: Math.floor(Math.random() * pipeImg.height) - pipeImg.height});
Â  Â  Â  }

Â  Â  Â  // Collision Detection
Â  Â  Â  if (
Â  Â  Â  Â  (bX + birdWidth >= pipe[i].x && bX <= pipe[i].x + 60 &&
Â  Â  Â  Â  (bY <= pipe[i].y + 200 || bY + birdHeight >= pipe[i].y + constant)) ||
Â  Â  Â  Â  bY + birdHeight >= canvas.height
Â  Â  Â  ) {
Â  Â  Â  Â  failCount++;
Â  Â  Â  Â  if (failCount >= 5) {
Â  Â  Â  Â  Â  showGameOver();
Â  Â  Â  Â  Â  return; // Stop the draw loop
Â  Â  Â  Â  }
Â  Â  Â  }

Â  Â  Â  if (pipe[i].x === 5) {
Â  Â  Â  Â  score++;
Â  Â  Â  Â  if (score === 10) showFireworks('Awesome!');
Â  Â  Â  Â  if (score === 15) showFireworks('You are Insurance VA Expert!');
Â  Â  Â  Â  updateLeaderboards();
Â  Â  Â  Â  if (score % 3 === 0) showQuiz();
Â  Â  Â  }
Â  Â  }

Â  Â  bY += gravity; // Apply gravity only when playing
Â  }
Â  
Â  // --- Bird Flapping Animation (happens regardless of game state) ---
Â  frame++;
Â  let birdFrame = Math.floor(frame / flapSpeed) % 3; // Cycle through 3 frames
Â  ctx.drawImage(
Â  Â  birdSprite,
Â  Â  birdFrame * spriteWidth, 0, spriteWidth, spriteHeight,
Â  Â  bX, bY, birdWidth, birdHeight
Â  );
Â  // -----------------------------------------------------------------

Â  ctx.fillStyle = "#fff";
Â  ctx.font = "18px Verdana";
Â  ctx.fillText("Score: " + score, 10, canvas.height - 20);

Â  requestAnimationFrame(draw);
}

// --- New Countdown Logic ---
function startCountdown() {
Â  let count = 3;
Â  countdownOverlay.style.display = 'flex';
Â  countdownOverlay.innerText = count;

Â  const interval = setInterval(() => {
Â  Â  count--;
Â  Â  if (count > 0) {
Â  Â  Â  countdownOverlay.innerText = count;
Â  Â  } else if (count === 0) {
Â  Â  Â  countdownOverlay.innerText = 'GO!';
Â  Â  } else {
Â  Â  Â  clearInterval(interval);
Â  Â  Â  countdownOverlay.style.display = 'none';
Â  Â  Â  startGame();
Â  Â  }
Â  }, 1000);

Â  // We call draw() once here to start the animation loop which will show the bird and background
Â  draw();
}

function startGame() {
Â  gameState = 'playing';
}
// ---------------------------

// Quiz, leaderboard, fireworks, same logic as before
function showQuiz() {
Â  document.getElementById('quizContainer').style.display = 'block';
Â  gameState = 'paused'; // Pause game while quiz is open
Â  loadQuestion();
}
function hideQuiz() { 
Â  document.getElementById('quizContainer').style.display = 'none'; 
Â  gameState = 'playing'; // Resume game
}
const questions = [
Â  {q:"What does liability insurance cover?", a:["Damage you cause to others","Your own injuries","Only theft","Natural disasters"], correct:0},
Â  {q:"What is deductible?", a:["Amount insurer pays","Amount you pay before insurance","Tax credit","Commission"], correct:1},
Â  {q:"What does 'premium' mean?", a:["The payment for coverage","The limit of coverage","Discount","Policy expiration"], correct:0},
Â  {q:"What is ACORD Form used for?", a:["Policy cancellation","Certificate of insurance","Filing taxes","License renewal"], correct:1},
Â  {q:"What is 'endorsement'?", a:["Policy change","Claim payment","Underwriting report","Billing issue"], correct:0},
Â  {q:"Home Insurance Coverage A is for?", a:["Dwelling","Personal property","Liability","Loss of use"], correct:0},
Â  {q:"Coverage B refers to?", a:["Other structures","Dwelling","Medical payments","Water damage"], correct:0},
Â  {q:"Umbrella insurance provides?", a:["Extra liability limit","Flood coverage","Car repair","Mortgage"], correct:0},
Â  {q:"Cyber Liability protects against?", a:["Data breaches","Storm damage","Fire","Theft"], correct:0},
Â  {q:"Flood insurance is provided by?", a:["NFIP","FEMA only","Private agents only","Auto carriers"], correct:0},
Â  {q:"What is peril?", a:["Cause of loss","Policy type","Payment mode","Agent type"], correct:0},
Â  {q:"Declarations page shows?", a:["Policy details","Claim status","Invoices","Personal notes"], correct:0},
Â  {q:"Named peril policy covers?", a:["Listed causes only","All losses","Exclusions","Uninsured"], correct:0},
Â  {q:"Inland marine covers?", a:["Movable property","Houses","Boats","Buildings"], correct:0},
Â  {q:"Business Owners Policy (BOP) combines?", a:["Property & Liability","Auto & Health","Workers Comp","Life & Disability"], correct:0},
Â  {q:"Auto Liability splits 100/300/50 mean?", a:["Per person/accident/property","Rates","Mileage","Deductible"], correct:0},
Â  {q:"Workers Comp covers?", a:["Employee injuries","Property damage","Auto theft","Fire"], correct:0},
Â  {q:"Medical payments cover?", a:["Immediate medical costs","Long-term loss","Business loans","Disability"], correct:0},
Â  {q:"Comprehensive Auto covers?", a:["Non-collision damages","Collisions","Liability","Parking fees"], correct:0},
Â  {q:"Collision coverage covers?", a:["Your car hitting objects","Natural disasters","Theft","Vandalism"], correct:0}
];
let currentQuestion = 0;
function loadQuestion() {
Â  let q = questions[currentQuestion % questions.length];
Â  document.getElementById('question').innerText = q.q;
Â  let answersDiv = document.getElementById('answers');
Â  answersDiv.innerHTML = "";
Â  q.a.forEach((ans, i)=>{
Â  Â  let btn = document.createElement('button');
Â  Â  btn.innerText = ans;
Â  Â  btn.onclick = ()=>checkAnswer(i, q.correct);
Â  Â  answersDiv.appendChild(btn);
Â  });
}
function checkAnswer(selected, correct) {
Â  if (selected === correct) {
Â  Â  quizScore++;
Â  Â  alert("âœ… Correct!");
Â  } else alert("âŒ Wrong!");
Â  updateLeaderboards();
Â  currentQuestion++;
Â  hideQuiz();
}
function updateLeaderboards() {
Â  localStorage.setItem('pipeScore', score);
Â  localStorage.setItem('quizScore', quizScore);
Â  renderLeaderboard();
}
function renderLeaderboard() {
Â  document.getElementById('pipeScores').innerHTML = `<li class="top">You: ${score}</li>`;
Â  document.getElementById('quizScores').innerHTML = `<li class="top">You: ${quizScore}</li>`;
}
function showGameOver() {
Â  gameState = 'gameover'; // Set game state to stop movement/pipes
Â  document.getElementById('gameOverModal').style.display = 'flex';
}
function returnToDashboard() {
Â  // Note: Your original code used 'game.html' here, which will just refresh the page.
Â  // If you have a separate dashboard, use that URL instead.
Â  window.location.href = "game.html"; 
}
function showFireworks(message) {
Â  const fwContainer = document.getElementById('fireworks');
Â  fwContainer.innerHTML = '';
Â  fwContainer.style.display = 'block';
Â  // No change to text here, as this is used for awesome scores, not game over
Â  // document.getElementById('gameOverText').innerText = message; 
Â  for (let i = 0; i < 40; i++) {
Â  Â  const spark = document.createElement('div');
Â  Â  spark.classList.add('spark');
Â  Â  const x = Math.random() * window.innerWidth;
Â  Â  const y = Math.random() * window.innerHeight;
Â  Â  spark.style.left = `${x}px`;
Â  Â  spark.style.top = `${y}px`;
Â  Â  spark.style.animationDelay = `${Math.random()}s`;
Â  Â  fwContainer.appendChild(spark);
Â  }
Â  setTimeout(() => {
Â  Â  fwContainer.style.display = 'none';
Â  Â  fwContainer.innerHTML = '';
Â  }, 3000);
}

document.getElementById('giveUpBtn').onclick = showGameOver;
renderLeaderboard();
</script>
</body>
</html>
