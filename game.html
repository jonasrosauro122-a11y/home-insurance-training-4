<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LAVA Classroom Game</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #000, #7a0000);
      color: #fff;
    }
    header.site-header {
      background: #000;
      color: white;
      padding: 10px 0;
      text-align: center;
      font-weight: bold;
      font-size: 1.3rem;
      border-bottom: 3px solid red;
    }
    #gameContainer {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 15px;
      height: 500px;
      margin: 40px auto;
      overflow: hidden;
      max-width: 1200px;
    }
    canvas {
      background: url('images/bg.png') repeat-x;
      background-size: cover;
      display: block;
      margin: 0 auto;
      width: 480px;
      height: 400px;
      border-radius: 10px;
      box-shadow: 0 0 15px red;
    }
    .leaderboard, .quizboard {
      width: 220px;
      background: rgba(0,0,0,0.85);
      padding: 15px;
      box-shadow: 0 0 20px red;
      border-radius: 10px;
      height: 90%;
      overflow-y: auto;
    }
    .leaderboard h2, .quizboard h2 {
      color: #ff2b2b;
      text-align: center;
      border-bottom: 2px solid red;
      padding-bottom: 5px;
      font-size: 1.1em;
    }
    .leaderboard ul, .quizboard ul { list-style: none; padding: 0; margin: 0; }
    .leaderboard li, .quizboard li { padding: 5px 10px; margin: 5px 0; background: #111; border-radius: 5px; font-size: 0.9em; }
    .leaderboard li.top { background: #ff2b2b; color: #fff; font-weight: bold; box-shadow: 0 0 10px #ff2b2b; }
    #giveUpBtn {
      position: absolute;
      top: 90px;
      right: 30px;
      background: red;
      border: none;
      color: #fff;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 6px;
      box-shadow: 0 0 10px #ff0000;
    }
    #giveUpBtn:hover { background: #a10000; }
    #quizContainer {
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.9);
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      color: white;
      display: none;
      box-shadow: 0 0 20px red;
      width: 350px;
      z-index: 900;
    }
    #quizContainer button {
      background: red;
      color: #fff;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }
    #quizContainer button:hover { background: #b30000; }
    #gameOverModal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.9);
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      color: #fff;
      z-index: 1000;
    }
    #gameOverModal button {
      margin-top: 20px;
      background: red;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 18px;
      cursor: pointer;
      box-shadow: 0 0 10px #ff0000;
    }
    #countdownOverlay {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 8em;
      color: #ff2b2b;
      font-weight: bold;
      z-index: 500;
    }
    .fireworks {
      position: fixed;
      width: 100%;
      height: 100%;
      top: 0; left: 0;
      pointer-events: none;
      display: none;
      z-index: 2000;
    }
    .spark {
      position: absolute;
      width: 5px; height: 5px;
      background: radial-gradient(circle, #ff0000, #ff6600, transparent);
      border-radius: 50%;
      animation: explode 1s ease-out forwards;
    }
    @keyframes explode { from { transform: scale(0) translateY(0); opacity:1; } to { transform: scale(2) translateY(-200px); opacity:0; } }
    @media (max-width: 768px){
      #gameContainer { flex-direction: column; height:auto; }
      canvas { width: 90%; height:auto; }
      .leaderboard, .quizboard { width: 90%; height:auto; }
    }
  </style>
</head>
<body>
<header class="site-header">üéÆ LAVA Classroom Insurance Game</header>

<div id="gameContainer">
  <div class="leaderboard"><h2>üèÜ Pipe Scores</h2><ul id="pipeScores"></ul></div>
  <div style="position: relative;">
    <canvas id="gameCanvas" width="480" height="400"></canvas>
    <div id="countdownOverlay">3</div>
  </div>
  <div class="quizboard"><h2>üß† Quiz Scores</h2><ul id="quizScores"></ul></div>
</div>

<button id="giveUpBtn">Give Up</button>

<div id="quizContainer"><h3 id="question"></h3><div id="answers"></div></div>

<div id="gameOverModal">
  <h1 id="gameOverText">Game Over</h1>
  <button onclick="returnToDashboard()">Return to Dashboard</button>
</div>

<div class="fireworks" id="fireworks"></div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const countdownOverlay = document.getElementById('countdownOverlay');
const birdSprite = new Image(); birdSprite.src='images/bird.png';
const bg = new Image(); bg.src='images/bg.png';
const pipeImg = new Image(); pipeImg.src='images/pipe.png';

let frame=0, flapSpeed=6, spriteWidth=34, spriteHeight=24, birdWidth=38, birdHeight=26;
let bX=10, bY=150, gravity=1.5, gap=120, score=0, quizScore=0, failCount=0;
let pipes=[{x:canvas.width, y:0}];
let gameState='ready', currentQuestion=0;

document.addEventListener('keydown', ()=>{if(gameState==='playing') bY-=25;});

Promise.all([new Promise(res=>birdSprite.onload=res), new Promise(res=>bg.onload=res), new Promise(res=>pipeImg.onload=res)]).then(startCountdown);

function startCountdown(){
  let count=3; countdownOverlay.style.display='flex'; countdownOverlay.innerText=count;
  const interval = setInterval(()=>{
    count--; 
    if(count>0) countdownOverlay.innerText=count; 
    else if(count===0) countdownOverlay.innerText='GO!';
    else{ clearInterval(interval); countdownOverlay.style.display='none'; startGame(); }
  },1000);
  draw();
}

function startGame(){ gameState='playing'; }

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(bg,0,0,canvas.width,canvas.height);

  if(gameState==='playing'){
    for(let i=0;i<pipes.length;i++){
      const p=pipes[i], topH=200, bottomY=p.y+topH+gap;
      ctx.drawImage(pipeImg,p.x,p.y,60,topH);
      ctx.drawImage(pipeImg,p.x,bottomY,60,topH);
      p.x-=2;
      if(p.x+60<0)pipes.splice(i,1);
      if(p.x===200)pipes.push({x:canvas.width, y:Math.floor(Math.random()*(canvas.height-gap-topH))});
      if((bX+birdWidth>=p.x && bX<=p.x+60 && (bY<=p.y+topH || bY+birdHeight>=bottomY)) || bY+birdHeight>=canvas.height){
        failCount++; if(failCount>=5) showGameOver();
      }
      if(p.x===5){ score++; if(score===10||score===15) showFireworks(); updateLeaderboards(); if(score%3===0) showQuiz(); }
    }
    bY+=gravity;
  }

  frame++; const birdFrame=Math.floor(frame/flapSpeed)%3;
  ctx.drawImage(birdSprite,birdFrame*spriteWidth,0,spriteWidth,spriteHeight,bX,bY,birdWidth,birdHeight);
  ctx.fillStyle="#fff"; ctx.font="18px Verdana"; ctx.fillText("Score: "+score,10,canvas.height-20);
  requestAnimationFrame(draw);
}

// Quiz Logic
const questions=[{q:"What does liability insurance cover?",a:["Damage you cause to others","Your own injuries","Only theft","Natural disasters"],correct:0},{q:"What is deductible?",a:["Amount insurer pays","Amount you pay before insurance","Tax credit","Commission"],correct:1},{q:"What does 'premium' mean?",a:["The payment for coverage","The limit of coverage","Discount","Policy expiration"],correct:0},{q:"What is ACORD Form used for?",a:["Policy cancellation","Certificate of insurance","Filing taxes","License renewal"],correct:1},{q:"Home Insurance Coverage A is for?",a:["Dwelling","Personal property","Liability","Loss of use"],correct:0}];

function showQuiz(){document.getElementById('quizContainer').style.display='block'; gameState='paused'; loadQuestion();}
function hideQuiz(){document.getElementById('quizContainer').style.display='none'; gameState='playing';}
function loadQuestion(){const q=questions[currentQuestion%questions.length]; document.getElementById('question').innerText=q.q; const ansDiv=document.getElementById('answers'); ansDiv.innerHTML=''; q.a.forEach((ans,i)=>{const btn=document.createElement('button'); btn.innerText=ans; btn.onclick=()=>checkAnswer(i,q.correct); ansDiv.appendChild(btn);});}
function checkAnswer(selected,correct){if(selected===correct) quizScore++; currentQuestion++; hideQuiz(); updateLeaderboards();}
function updateLeaderboards(){renderLeaderboard();}
function renderLeaderboard(){document.getElementById('pipeScores').innerHTML=`<li class="top">You: ${score}</li>`; document.getElementById('quizScores').innerHTML=`<li class="top">You: ${quizScore}</li>`;}
function showGameOver(){gameState='gameover'; document.getElementById('gameOverModal').style.display='flex';}
function returnToDashboard(){window.location.href="game.html";}
function showFireworks(){const fw=document.getElementById('fireworks'); fw.innerHTML=''; fw.style.display='block'; for(let i=0;i<40;i++){const s=document.createElement('div'); s.classList.add('spark'); s.style.left=Math.random()*window.innerWidth+'px'; s.style.top=Math.random()*window.innerHeight+'px'; s.style.animationDelay=Math.random()+'s'; fw.appendChild(s);} setTimeout(()=>{fw.style.display='none'; fw.innerHTML='';},3000);}
document.getElementById('giveUpBtn').onclick=showGameOver;
renderLeaderboard();
</script>
</body>
</html>
