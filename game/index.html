<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Flappy ‚Ä¢ LAVA Classroom</title>
<link rel="stylesheet" href="style.css">
<style>
  :root { --accent:#ff1f1f; --bg-start:#000; --bg-end:#480000; }
  html,body { height:100%; margin:0; font-family:'Poppins',sans-serif; background: linear-gradient(120deg,var(--bg-start),var(--bg-end)); color:#fff; }
  .site-header { position:fixed; top:0; left:0; right:0; z-index:60; background: rgba(0,0,0,0.65); backdrop-filter: blur(4px); }
  .header-inner.container { display:flex; align-items:center; justify-content:space-between; padding:12px 20px; max-width:1200px; margin:0 auto; }
  .brand { display:flex; align-items:center; gap:10px; color:#fff; text-decoration:none; font-weight:700; }
  .brand img { height:36px; }
  .main-nav ul { display:flex; gap:14px; list-style:none; margin:0; padding:0; }
  .main-nav a { color:#fff; text-decoration:none; padding:6px 10px; border-radius:6px; font-weight:500; }
  .main-nav a:hover { background: rgba(255,255,255,0.04); color:var(--accent); }
  .main-nav a.active { background:var(--accent); color:#fff; }

  /* Game shell below header */
  .game-shell { position:relative; width:100%; height: calc(100vh - 64px); margin-top:64px; display:flex; align-items:center; justify-content:center; overflow:hidden; }
  #gameContainer { position:relative; }
  canvas#gameCanvas { display:block; max-width:100%; width:420px; height:630px; border-radius:10px; border:3px solid var(--accent); background:#70c8ff; box-shadow:0 12px 40px rgba(0,0,0,0.6); }

  /* HUD */
  .hud { position:absolute; top:14px; left:50%; transform:translateX(-50%); z-index:50; text-align:center; pointer-events:none; }
  .score { font-size:28px; font-weight:700; color:#fff; text-shadow:0 3px 10px rgba(0,0,0,0.6); pointer-events:auto; }
  .highscore { font-size:12px; color:rgba(255,255,255,0.85); margin-top:4px; }

  /* Start box and UI */
  #startBox { text-align:center; margin-bottom:12px; }
  .btn { padding:8px 14px; border-radius:8px; border:none; cursor:pointer; font-weight:700; background:var(--accent); color:#fff; }
  .btn.secondary { background:transparent; border:1px solid rgba(255,255,255,0.12); color:#fff; margin-left:8px; }

  /* Quiz popup */
  #questionBox {
    display:none;
    position:absolute;
    left:50%;
    top:16%;
    transform:translateX(-50%);
    background:#111;
    padding:16px;
    border:2px solid #ff5555;
    border-radius:12px;
    width:86%;
    max-width:560px;
    z-index:120;
    color:#fff;
    text-align:center;
  }
  #questionBox input[type="text"] { padding:8px; border-radius:6px; border:1px solid #333; width:72%; margin-bottom:8px; }

  /* overlay for game over */
  .overlay { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; z-index:110; pointer-events:none; }
  .panel { pointer-events:auto; background:rgba(0,0,0,0.75); padding:18px 22px; border-radius:12px; text-align:center; color:#fff; border:1px solid rgba(255,255,255,0.05); }
  .panel h2 { margin:0 0 8px 0; }
  .panel p { margin:8px 0; color:#ddd; }

  /* leaderboard box */
  #leaderboard { margin-top:18px; background:rgba(255,255,255,0.06); padding:12px; border-radius:10px; max-width:420px; margin-left:auto; margin-right:auto; }

  @media (max-width:520px) {
    canvas#gameCanvas { width:92vw; height: calc(92vw * 1.5); }
    .score { font-size:22px; }
  }
</style>
</head>
<body>

<header class="site-header">
  <div class="header-inner container">
    <a class="brand" href="index.html"><img src="images/logo.png" alt="LAVA"><span>LAVA Classroom</span></a>
    <nav class="main-nav" aria-label="Main navigation">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="about.html">Trainers</a></li>
        <li><a href="courses.html">Courses</a></li>
        <li><a href="assignments.html">LAVA University</a></li>
        <li><a href="game.html" class="active">Games</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
    </nav>
  </div>
</header>

<main style="text-align:center; padding:18px 12px 40px;">
  <h1 style="margin-top:72px;">üèÜ LAVA Flappy Insurance ‚Äî Classic Mode</h1>

  <div id="startBox">
    <input id="playerName" type="text" placeholder="Enter your name" style="padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.12);width:220px;margin-right:8px;">
    <button id="startGameBtn" class="btn">Start Game</button>
    <button id="musicControl" class="btn secondary">üîä Music</button>
  </div>

  <div class="game-shell">
    <div id="gameContainer">
      <div class="hud">
        <div class="score" id="scoreLabel">0</div>
        <div class="highscore" id="highLabel">High: 0</div>
      </div>

      <canvas id="gameCanvas" width="400" height="600" role="img" aria-label="Flappy bird game"></canvas>

      <!-- Quiz popup (appears on collision) -->
      <div id="questionBox" role="dialog" aria-modal="true">
        <h3 id="questionText"></h3>
        <input id="answerInput" type="text" placeholder="Type your answer..."><br>
        <button id="submitAnswer" class="btn" style="margin-top:8px;">Submit</button>
      </div>

      <!-- Game over overlay -->
      <div class="overlay" id="gameOverOverlay" style="display:none;">
        <div class="panel">
          <h2 id="goTitle">Game Over</h2>
          <p id="goScore">Score: 0</p>
          <button id="restartBtn" class="btn">Play Again</button>
        </div>
      </div>
    </div>
  </div>

  <div id="leaderboard">
    <h3 style="margin:0 0 8px 0;">üèÖ Leaderboard (Top 5)</h3>
    <ul id="leaderList" style="list-style:none;padding-left:0;margin:0;"></ul>
  </div>
</main>

<footer class="site-footer" style="text-align:center;padding:18px 0;">
  <div class="footer-inner container">
    <p style="color:#fff;">¬© 2025 LAVA Classroom. All Rights Reserved.</p>
  </div>
</footer>

<!-- background music (optional) -->
<audio id="bgMusic" loop>
  <source src="https://cdn.pixabay.com/download/audio/2022/10/09/audio_65e0d2f6cb.mp3?filename=arcade-funk-124689.mp3" type="audio/mpeg">
</audio>

<script>
/* ===================== FLAPPY + QUIZ GAME (sprite-based) ===================== */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const scoreLabel = document.getElementById('scoreLabel');
const highLabel = document.getElementById('highLabel');
const questionBox = document.getElementById('questionBox');
const questionText = document.getElementById('questionText');
const answerInput = document.getElementById('answerInput');
const submitAnswer = document.getElementById('submitAnswer');
const startGameBtn = document.getElementById('startGameBtn');
const restartBtn = document.getElementById('restartBtn');
const goScore = document.getElementById('goScore');
const overlay = document.getElementById('gameOverOverlay');
const musicControl = document.getElementById('musicControl');
const bgMusic = document.getElementById('bgMusic');
const leaderList = document.getElementById('leaderList');

let musicPlaying = false;
musicControl.addEventListener('click', ()=> {
  if(!musicPlaying){ bgMusic.play().catch(()=>{}); musicPlaying=true; musicControl.textContent='üîà Music Off'; }
  else { bgMusic.pause(); musicPlaying=false; musicControl.textContent='üîä Music'; }
});

// images (must exist in images/ folder)
const birdImg = new Image(); birdImg.src = 'images/bird.png';
const pipeImg = new Image();  pipeImg.src = 'images/pipe.png';
const bgImg   = new Image();  bgImg.src = 'images/bg.png'; // optional background image (will be drawn if present)

// game constants
const W = canvas.width;
const H = canvas.height;
const groundHeight = 48;
const pipeWidth = 52;       // width we draw pipes at
const pipeGap   = 150;      // gap between top and bottom
const pipeSpeed = 2.2;
const gravity   = 0.6;
const jumpPower = -10;

// state
let playerName = '';
let bird = { x: 80, y: H/2, w: 34, h: 24, vel: 0, rot: 0 };
let pipes = []; // {x, top, bottom, passed}
let frame = 0;
let score = 0;
let running = false;
let gameOver = false;
let questionActive = false;

// questions (kept from your list)
const questions = [
  {q:"An organization of insurers through which risks are pooled.", a:"insurance pool"},
  {q:"Anyone can be an agent. True or False.", a:"false"},
  {q:"A financial agreement to transfer risk for premiums.", a:"insurance"},
  {q:"Total cost or price of the policy.", a:"premium"},
  {q:"Professional who evaluates risk.", a:"underwriter"},
  {q:"Works for ONE insurance company only. They are ____.", a:"captive agent"},
  {q:"Represents the client, not the insurance company.", a:"broker"},
  {q:"What is ACV?", a:"actual cash value"},
  {q:"Covers losses and damages to private properties.", a:"personal insurance"},
  {q:"Can give insurance advice and bind policies.", a:"insurance agent"},
  {q:"Amount you pay out of pocket before insurance starts.", a:"deductible"},
  {q:"Regular payment to keep your policy active.", a:"premium"},
  {q:"Person who investigates your claim.", a:"claims adjuster"},
  {q:"Maximum amount insurer will pay for covered loss.", a:"policy limit"},
  {q:"A request you make to cover loss or damage.", a:"claim"},
  {q:"Protection that pays for damage you cause to others.", a:"liability coverage"},
  {q:"Coverage for non-collision damages (fire, theft).", a:"comprehensive coverage"},
  {q:"Process of continuing your insurance policy.", a:"policy renewal"},
  {q:"Coverage that pays for damage to your own car when you hit another object.", a:"collision coverage"},
  {q:"Proof of your insurance coverage document.", a:"certificate of insurance"},
  {q:"Person or business protected under a policy.", a:"insured"},
  {q:"Company that provides insurance coverage.", a:"insurer"},
  {q:"Change or addition made to existing policy.", a:"endorsement"},
  {q:"Document outlining terms, coverages, exclusions.", a:"policy"},
  {q:"Meaning of AMS.", a:"agency management system"}
];

// leaderboard helpers
function loadLeaderboard(){
  const lb = JSON.parse(localStorage.getItem('lava_leaderboard') || '[]');
  leaderList.innerHTML = '';
  lb.forEach((p,i)=> {
    const li = document.createElement('li');
    li.textContent = `${i+1}. ${p.name} ‚Äî ${p.score}`;
    leaderList.appendChild(li);
  });
}

// spawn a pair of pipes
function spawnPipe(){
  const top = Math.random()*(H - pipeGap - 140) + 40; // safe top range
  pipes.push({ x: W + 20, top: top, bottom: top + pipeGap, passed: false });
}

// draw background (optional)
function drawBackground(){
  if(bgImg.complete && bgImg.naturalWidth){
    // scale bg to canvas
    ctx.drawImage(bgImg, 0, 0, W, H);
  } else {
    // fallback sky + ground
    const g = ctx.createLinearGradient(0,0,0,H);
    g.addColorStop(0, '#70c8ff');
    g.addColorStop(1, '#bfefff');
    ctx.fillStyle = g;
    ctx.fillRect(0,0,W,H);
    // ground
    ctx.fillStyle = '#7ec850';
    ctx.fillRect(0,H-groundHeight,W,groundHeight);
  }
}

// draw bird sprite with rotation
function drawBird(){
  ctx.save();
  ctx.translate(bird.x + bird.w/2, bird.y + bird.h/2);
  ctx.rotate(bird.rot);
  if(birdImg.complete){
    ctx.drawImage(birdImg, -bird.w/2, -bird.h/2, bird.w, bird.h);
  } else {
    ctx.fillStyle = '#ff5555';
    ctx.beginPath();
    ctx.arc(0,0,10,0,Math.PI*2);
    ctx.fill();
  }
  ctx.restore();
}

// draw pipes using pipeImg (flip top)
function drawPipes(){
  pipes.forEach(pipe => {
    // top pipe (flip)
    ctx.save();
    ctx.translate(pipe.x + pipeWidth()/2, pipe.top/2);
    ctx.scale(1, -1);
    ctx.drawImage(pipeImg, -pipeWidth()/2, -pipe.top, pipeWidth(), pipe.top);
    ctx.restore();
    // bottom pipe
    const bottomH = H - pipe.bottom;
    ctx.drawImage(pipeImg, pipe.x, pipe.bottom, pipeWidth(), bottomH);
  });
}
function pipeWidth(){ return pipeImg.complete ? Math.max(40, Math.floor(pipeImg.width * (pipeWidthScale()))) : 52; }
function pipeWidthScale(){ return 52 / (pipeImg.width || 52); } // keep desired width 52

// update physics and game state
function update(){
  if(!running || questionActive) return;

  frame++;

  // physics
  bird.vel += gravity;
  bird.y += bird.vel;
  bird.rot = Math.min(Math.PI/6, bird.vel/10);

  // move pipes
  for(let p of pipes) p.x -= pipeSpeed;

  // spawn new pipes periodically
  if(frame % 90 === 0) spawnPipe();

  // remove offscreen
  pipes = pipes.filter(p => p.x + pipeWidth() > -20);

  // scoring
  pipes.forEach(pipe => {
    if(!pipe.passed && pipe.x + pipeWidth() < bird.x){
      pipe.passed = true;
      score++;
      scoreLabel.textContent = score;
      // update highscore
      if(score > highScore){
        highScore = score;
        localStorage.setItem('lava_highscore', String(highScore));
        highLabel.textContent = 'High: ' + highScore;
      }
    }
  });

  // collisions
  for(let p of pipes){
    const withinX = bird.x + bird.w > p.x && bird.x < p.x + pipeWidth();
    if(withinX && (bird.y < p.top || bird.y + bird.h > p.bottom)){
      // collision -> quiz popup
      openQuiz();
      return;
    }
  }

  // ground/ceiling collision -> quiz too
  if(bird.y + bird.h > H - groundHeight || bird.y < 0){
    openQuiz();
    return;
  }
}

// render everything
function render(){
  ctx.clearRect(0,0,W,H);
  drawBackground();
  drawPipes();
  drawBird();
}

// main loop
function loop(){
  if(running && !gameOver){
    update();
    render();
    requestAnimationFrame(loop);
  }
}

// flap input
function flap(){
  if(!running && !gameOver){
    startGame();
    return;
  }
  if(gameOver || questionActive) return;
  bird.vel = jumpPower;
  bird.rot = -0.6;
}

// show quiz popup on collision
function openQuiz(){
  questionActive = true;
  running = false;
  // pick random question
  const q = questions[Math.floor(Math.random() * questions.length)];
  currentQuestion = q;
  questionText.textContent = q.q;
  answerInput.value = '';
  questionBox.style.display = 'block';
  answerInput.focus();
}

// handle quiz submit
let currentQuestion = null;
submitAnswer.addEventListener('click', ()=> {
  if(!currentQuestion) return;
  const ans = answerInput.value.trim().toLowerCase();
  if(ans === currentQuestion.a.toLowerCase()){
    // correct -> resume game with small boost
    questionBox.style.display = 'none';
    questionActive = false;
    bird.vel = -6;
    running = true;
    loop();
  } else {
    // wrong -> game over
    questionBox.innerHTML = `<h3 style="color:#fff;">‚ùå Wrong Answer! Game Over!</h3><p style="color:#ffdcdc;">Correct: <b>${currentQuestion.a}</b></p>`;
    setTimeout(() => {
      endGame();
      // restore questionBox markup (in case player restarts)
      questionBox.innerHTML = `<h3 id="questionText" style="color:#fff;"></h3>
        <input id="answerInput" type="text" placeholder="Type your answer..." style="padding:8px;border-radius:6px;border:1px solid #333;width:72%;margin-bottom:8px;"><br>
        <button id="submitAnswer" class="btn" style="margin-top:8px;">Submit</button>`;
      // rebind submitAnswer and answerInput variables
      bindQuestionControls();
    }, 1400);
  }
});

// after replacing questionBox innerHTML, rebind controls
function bindQuestionControls(){
  const newSubmit = document.getElementById('submitAnswer');
  const newAnswer = document.getElementById('answerInput');
  if(newSubmit){
    newSubmit.addEventListener('click', ()=> {
      // trigger same handler by simulating click
      submitAnswer.click();
    });
  }
  // reassign global refs
  if(newAnswer) answerInput = newAnswer;
}

// start game resets
function startGame(){
  playerName = (document.getElementById('playerName') || {value:''}).value.trim();
  if(!playerName){
    alert('Please enter your name first!');
    return;
  }
  // reset
  pipes = [];
  frame = 0;
  score = 0;
  scoreLabel.textContent = 0;
  bird.y = H/2;
  bird.vel = 0;
  running = true;
  gameOver = false;
  questionActive = false;
  overlay.style.display = 'none';
  spawnPipe(); spawnPipe();
  loop();
}

// end game: show overlay and save score
function endGame(){
  running = false;
  gameOver = true;
  overlay.style.display = 'flex';
  goScore.textContent = 'Score: ' + score;
  // save leaderboard
  const lb = JSON.parse(localStorage.getItem('lava_leaderboard') || '[]');
  lb.push({ name: playerName || 'Player', score: score });
  lb.sort((a,b)=> b.score - a.score);
  const top = lb.slice(0,5);
  localStorage.setItem('lava_leaderboard', JSON.stringify(top));
  loadLeaderboard();
}

// openQuiz calls endGame on wrong answer; but if user leaves quiz unanswered and restarts, ensure controls ok.

// event listeners
document.addEventListener('keydown', (e)=> {
  if(e.code === 'Space'){ e.preventDefault(); flap(); }
});
canvas.addEventListener('click', ()=> flap());
canvas.addEventListener('touchstart', (e)=> { e.preventDefault(); flap(); }, {passive:false});

startGameBtn.addEventListener('click', startGame);
restartBtn.addEventListener('click', ()=> { overlay.style.display='none'; startGame(); });

// highscore HUD
let highScore = parseInt(localStorage.getItem('lava_highscore') || '0', 10);
highLabel.textContent = 'High: ' + highScore;

// load leaderboard at start
loadLeaderboard();

// initial render when bird image ready
birdImg.onload = function(){
  // scale bird logical w/h to image aspect (cap max)
  const ratio = birdImg.width / Math.max(1, birdImg.height);
  bird.w = Math.min(48, birdImg.width);
  bird.h = Math.round(bird.w / ratio);
  renderInitial();
};

function renderInitial(){
  ctx.clearRect(0,0,W,H);
  drawBackground();
  if(pipeImg.complete) drawPipes();
  drawBird();
}

// bind submitAnswer variable (since we replaced it on wrong answers)
function rebindSubmit(){
  const s = document.getElementById('submitAnswer');
  if(s) {
    s.addEventListener('click', ()=>{ submitAnswer.click(); });
  }
}

// ensure answerInput / submitAnswer refs are live
// (we declared const submitAnswer earlier; for safety, allow reassignment if DOM replaced)
window.addEventListener('click', function(){ /* no-op to keep page interactive */ });

// Expose a small help: click Start to begin
</script>
</body>
</html>
